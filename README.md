# Project for Protei It School

## Библиотеки ##

* Boost 1.83.0
* Google Test
* Google Log
* Nlohmann_json

## Установка ##

1. mkdir build
2. cd build
3. cmake .. -DCMAKE_TOOLCHAIN_FILE={path_to_vcpkg}/scripts/buildsystems/vcpkg.cmake
4. cmake --build .
5. ./build/CallCenterExec, ./build/ClientExec, ./build/call_center_test - запуск сервера, клиента и тестов
   соответственно

## Краткая документация ##

* HttpServer - простая реализация асинхронного tcp сервера. Принимает новые подключения к серверу и для каждого создает
  отдельную сессию
* HttpSession - определяет необходимый сервис и занимается обработкой тела запроса, в зависимости от сервиса.
* CallCenter - сервис, предоставляющий услуги ЦОВ. Управляет очередью вызовов и очередью операторов. В отдельном потоке
  происходит обработка новых вызовов: ЦОВ удаляет из очереди ближайший вызов, останавливается его Timeout таймер и
  устанавливает новый, эмулирующий длительность звонка между оператором и пользователем.
* Call - непосредственно звонок, связывающий пользователя и оператора в единую сущность. Звонок эмулируется таймером, по
  окончании которого звонок устанавливается в статус Timeout, после чего отправляет ответ пользователю с соответствующим
  статусом, а также удаляется из очереди.
* Operator - объект, реализующий логику оператора. В данный момент представляет собой целочисленное id.
* Config - конфигурация ЦОВ. Задает размер очереди, количество операторов, максимальное время ожидания в очереди, а
  также минимальную и максимальную длительность вызова.
* CDR - Call detail Record - запись о вызове в соответствующем журнале. Обладает следующими статусами:
1. OK - пользователь был подключен к оператору и успешно завершил разговор.
2. Duplicate - вызов дублируется в очереди.
3. Overload - размер очереди превышает допустимый лимит.
4. Timeout - истекло время ожидания подключения к оператору в очереди.
5. Interrupted - звонок прерван по инициативе пользователя.

## Конфигурация ##
Настройка конфигурации производится в папке output в корневой директории проекта в файле config.json.
Пример конфигурации:
{
"max_queue_length" : 3,
"queue_waiting_time" : 60,
"number_of_operators" : 2,
"min_call_duration" : 5,
"max_call_duration" : 10
}

## Call Detail Record (CDR) ##

1. Время подключения
2. Время ответа оператора (пустое значение, если ответа не было)
3. Время отключения от сервера
4. Длительность вызова (пустое значение, если ответа не было)
5. Идентификатор оператора (0, если сессия не была запущена)
6. Идентификатор вызова
7. Номер телефона пользователя
8. Статус вызова